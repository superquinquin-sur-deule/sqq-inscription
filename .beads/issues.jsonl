{"id":"sqq-inscription-00e","title":"Cooperateur management","description":"## Cooperateur Management\n\nEnhanced cooperateur management with detailed views and audit timeline.\n\n### 1. List All Cooperateurs (Enhancement)\n\n**Current State:** Basic table exists in `AdminCooperateurs.vue` with 18 columns\n\n**Enhancements:**\n- Add pagination (backend + frontend)\n- Add advanced filters: date range, status dropdown, tarif réduit toggle\n- Add column visibility toggle\n- Add CSV/Excel export functionality\n- Add bulk actions (select multiple → mark as processed)\n\n**Backend Changes:**\n- Modify `GET /api/v1/administration/cooperateurs` to support:\n  - `?page=0\u0026size=20` - Pagination\n  - `?status=PAID` - Status filter\n  - `?from=2024-01-01\u0026to=2024-12-31` - Date range\n  - `?search=query` - Server-side search\n\n### 2. View Details on Cooperateurs\n\n**New Component:** `CooperateurDetail.vue`\n\n**New Route:** `/admin/cooperateurs/:id`\n\n**Detail View Sections:**\n1. **Header** - Name, status badge, action buttons\n2. **Personal Information** - All contact details in card format\n3. **Membership Details** - Parts breakdown, tarif réduit status, foyer size\n4. **Binome Information** - If exists, show paired member details\n5. **Payment Information** - Stripe session ID, payment date, amount\n6. **Timeline** - Audit events (see section 3)\n\n**Backend:**\n- Existing: `GET /api/v1/administration/cooperateurs/{id}`\n- Enhance DTO to include computed fields (total amount, etc.)\n\n### 3. Timeline of Events (Audit Trail)\n\n**New Database Table:** `audit_event`\n```sql\nCREATE TABLE audit_event (\n  id BIGINT PRIMARY KEY,\n  entity_type VARCHAR(50) NOT NULL,  -- 'COOPERATEUR', 'SOUSCRIPTION_SUPPLEMENTAIRE'\n  entity_id BIGINT NOT NULL,\n  event_type VARCHAR(50) NOT NULL,   -- 'CREATED', 'STATUS_CHANGED', 'PAYMENT_CONFIRMED', 'PROCESSED'\n  old_value TEXT,                     -- JSON of previous state (optional)\n  new_value TEXT,                     -- JSON of new state (optional)\n  performed_by VARCHAR(100),          -- 'system', 'admin', 'stripe-webhook'\n  created_at TIMESTAMP NOT NULL\n);\n```\n\n**Event Types to Track:**\n- `CREATED` - Registration submitted\n- `PAYMENT_PENDING` - Stripe session created\n- `PAYMENT_CONFIRMED` - Stripe payment successful\n- `PAYMENT_RECONCILED` - Auto-reconciliation job updated status\n- `PROCESSED` - Admin marked as processed\n- `UPDATED` - Any field modification (future)\n\n**Backend Implementation:**\n1. Create `AuditEvent.java` entity\n2. Create `AuditService.java` with `logEvent()` method\n3. Add Flyway migration for audit_event table\n4. Inject audit logging into:\n   - `RegistrationResource.java` - on create, payment success\n   - `AdminResource.java` - on process\n   - `PaymentReconciliationJob.java` - on reconciliation\n5. New endpoint: `GET /api/v1/administration/cooperateurs/{id}/events`\n\n**Frontend Timeline Component:**\n- Vertical timeline with icons per event type\n- Timestamp in French locale\n- Color coding: blue (info), green (success), orange (pending)\n- Show `performed_by` actor\n\n### Files to Create/Modify\n\n**Backend (New):**\n- `src/main/java/org/sqq/registration/AuditEvent.java`\n- `src/main/java/org/sqq/registration/AuditEventDTO.java`\n- `src/main/java/org/sqq/registration/AuditService.java`\n- `src/main/resources/db/migration/V1.3.0__add-audit-events.sql`\n\n**Backend (Modify):**\n- `src/main/java/org/sqq/registration/AdminResource.java`\n- `src/main/java/org/sqq/registration/RegistrationResource.java`\n- `src/main/java/org/sqq/registration/AdditionalSharesResource.java`\n- `src/main/java/org/sqq/registration/PaymentReconciliationJob.java`\n\n**Frontend (New):**\n- `src/main/webui/src/components/CooperateurDetail.vue`\n- `src/main/webui/src/components/AuditTimeline.vue`\n\n**Frontend (Modify):**\n- `src/main/webui/src/router/index.ts`\n- `src/main/webui/src/components/AdminCooperateurs.vue`","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-12-26T14:53:17.132285+01:00","updated_at":"2025-12-26T16:39:35.60578+01:00","deleted_at":"2025-12-26T16:39:35.60578+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"sqq-inscription-0sc","title":"Create AuditLog entity","description":"## Create AuditLog Entity\n\nGeneral-purpose audit trail for all entity changes.\n\n### Fields\n\n| Field | Type | Notes |\n|-------|------|-------|\n| id | Long | Primary key |\n| entityType | String | e.g., 'CooperateurV2', 'PartTransaction' |\n| entityId | Long | ID of the affected entity |\n| action | String | CREATE, UPDATE, DELETE |\n| changes | Text/JSON | What changed (field: old → new) |\n| performedBy | String | User who made the change |\n| performedAt | Timestamp | |\n\n### Purpose\n- Comprehensive audit trail across all entities\n- Track who changed what and when\n- Support compliance and debugging\n\n### Acceptance Criteria\n- [ ] Entity class created\n- [ ] JSON storage for changes field\n- [ ] Indexes on entityType and entityId","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T17:29:51.133773+01:00","updated_at":"2025-12-26T17:30:42.285941+01:00"}
{"id":"sqq-inscription-2jp","title":"Create StatusHistory entity","description":"## Create StatusHistory Entity\n\nTracks status transitions for audit purposes.\n\n### Fields\n\n| Field | Type | Notes |\n|-------|------|-------|\n| id | Long | Primary key |\n| cooperateur_id | Long | FK to CooperateurV2 |\n| statusType | String | 'payment' or 'member' |\n| previousStatus | String | Status before change |\n| newStatus | String | Status after change |\n| changedAt | Timestamp | |\n| changedBy | String | User who made the change (optional) |\n\n### Purpose\n- Track when and why statuses change\n- Enable audit trail for compliance\n- Support status transition validation\n\n### Acceptance Criteria\n- [ ] Entity class created with FK to CooperateurV2\n- [ ] Index on cooperateur_id for efficient querying\n- [ ] Timestamps auto-populated","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T17:29:50.697457+01:00","updated_at":"2025-12-26T17:30:42.080136+01:00","dependencies":[{"issue_id":"sqq-inscription-2jp","depends_on_id":"sqq-inscription-9wi","type":"blocks","created_at":"2025-12-26T17:31:22.804267+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-46z","title":"Unit tests for share computation from transactions","description":"## Unit Tests for Share Computation\n\nWrite tests to verify share computation from PartTransaction records.\n\n### Test Cases\n\n1. **Basic computation**\n   - Single INITIAL_PURCHASE transaction\n   - Multiple transactions of same type\n\n2. **Mixed transactions**\n   - INITIAL_PURCHASE + ADDITIONAL_PURCHASE\n   - Transactions with REFUND (negative values)\n   - ADJUSTMENT transactions\n\n3. **Edge cases**\n   - No transactions (should return 0)\n   - All refunded (should return 0)\n   - Large number of transactions\n\n4. **Cooperateur with no shares**\n   - Verify graceful handling\n\n### Acceptance Criteria\n- [ ] Tests cover all PartTransactionType scenarios\n- [ ] Tests verify computation accuracy\n- [ ] Tests run in CI pipeline","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T17:29:52.686407+01:00","updated_at":"2025-12-26T17:31:04.731079+01:00","dependencies":[{"issue_id":"sqq-inscription-46z","depends_on_id":"sqq-inscription-dc4","type":"blocks","created_at":"2025-12-26T17:31:24.963366+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-5pt","title":"CooperateurV2 Data Model","description":"## CooperateurV2 Data Model Specification\n\n### Overview\nRestructure the Cooperateur data model to address:\n- **Data structure issues**: Missing member lifecycle states, share tracking as computed value\n- **Historical tracking**: Audit logs, status history, share transaction history\n- **Binome evolution**: Both people in a pair become full Cooperateurs linked via relationship table\n- **Source tracking**: Record origin of each member (online, import, manual)\n\n---\n\n### Core Entity: CooperateurV2\n\n| Field | Type | Notes |\n|-------|------|-------|\n| id | Long | Primary key (auto-generated) |\n| genre | Genre | MADAME, MONSIEUR |\n| prenom | String | First name (required) |\n| nom | String | Last name (required) |\n| **dateNaissance** | String | **NEW** - Birth date |\n| telephone | String | Required |\n| email | String | Required |\n| adresse | String | Required |\n| ville | String | Required |\n| codePostal | String | Required |\n| etudiantOuMinimasSociaux | Boolean | Student or low-income status |\n| nombreDePersonnesDansLeFoyer | Long | Household size (min 1) |\n| acceptationDesStatus | Boolean | Terms acceptance |\n| **paymentStatus** | PaymentStatus | Renamed from `status` - PENDING, PAID |\n| **memberStatus** | MemberStatus | **NEW** - PROSPECT, ACTIVE, SUSPENDED, DEPARTED |\n| **source** | DataSource | **NEW** - ONLINE_REGISTRATION, CSV_IMPORT, MANUAL_ENTRY |\n| **notes** | String | **NEW** - Admin notes (optional) |\n| stripeSessionId | String | Stripe checkout session ID |\n| createdAt | Timestamp | |\n| updatedAt | Timestamp | |\n\n**Removed fields:**\n- `parts` - Now computed from PartTransaction sum\n- `partsDeSoutien` - Tracked via PartTransaction\n- `binome_id` - Replaced by CooperateurRelationship table\n\n---\n\n### New Entity: CooperateurRelationship\n\nLinks Cooperateurs who registered together as a pair.\n\n| Field | Type | Notes |\n|-------|------|-------|\n| id | Long | Primary key |\n| cooperateur1_id | Long | FK to CooperateurV2 |\n| cooperateur2_id | Long | FK to CooperateurV2 |\n| relationshipType | RelationshipType | PAIR (extensible for future types) |\n| createdAt | Timestamp | |\n\n---\n\n### New Entity: PartTransaction\n\nTracks all share purchases and changes over time.\n\n| Field | Type | Notes |\n|-------|------|-------|\n| id | Long | Primary key |\n| cooperateur_id | Long | FK to CooperateurV2 |\n| transactionType | PartTransactionType | INITIAL_PURCHASE, ADDITIONAL_PURCHASE, ADJUSTMENT, REFUND |\n| parts | Long | Number of shares in this transaction (can be negative for refunds) |\n| reason | String | Optional explanation |\n| stripeSessionId | String | If payment was involved |\n| createdAt | Timestamp | |\n\n**Computing current shares:** `SELECT SUM(parts) FROM PartTransaction WHERE cooperateur_id = ?`\n\n---\n\n### New Entity: StatusHistory\n\nTracks status transitions for audit purposes.\n\n| Field | Type | Notes |\n|-------|------|-------|\n| id | Long | Primary key |\n| cooperateur_id | Long | FK to CooperateurV2 |\n| statusType | String | 'payment' or 'member' |\n| previousStatus | String | Status before change |\n| newStatus | String | Status after change |\n| changedAt | Timestamp | |\n| changedBy | String | User who made the change (optional) |\n\n---\n\n### New Entity: AuditLog\n\nGeneral-purpose audit trail for all entity changes.\n\n| Field | Type | Notes |\n|-------|------|-------|\n| id | Long | Primary key |\n| entityType | String | e.g., 'CooperateurV2', 'PartTransaction' |\n| entityId | Long | ID of the affected entity |\n| action | String | CREATE, UPDATE, DELETE |\n| changes | Text/JSON | What changed (field: old → new) |\n| performedBy | String | User who made the change |\n| performedAt | Timestamp | |\n\n---\n\n### Enums\n\n**DataSource**\n- `ONLINE_REGISTRATION` - Registered via web form\n- `CSV_IMPORT` - Imported from legacy CSV\n- `MANUAL_ENTRY` - Manually entered by admin\n\n**MemberStatus**\n- `PROSPECT` - Registered but not yet active\n- `ACTIVE` - Active cooperative member\n- `SUSPENDED` - Temporarily suspended\n- `DEPARTED` - Left the cooperative\n\n**PaymentStatus**\n- `PENDING` - Payment not yet completed\n- `PAID` - Payment received\n\n**RelationshipType**\n- `PAIR` - Binome/paired registration\n\n**PartTransactionType**\n- `INITIAL_PURCHASE` - First share purchase at registration\n- `ADDITIONAL_PURCHASE` - Subsequent share purchases\n- `ADJUSTMENT` - Manual correction by admin\n- `REFUND` - Shares returned\n\n---\n\n### Migration Considerations\n\n1. **Binome → CooperateurV2**: Each Binome becomes a full CooperateurV2 record\n2. **Link preservation**: Create CooperateurRelationship records for existing pairs\n3. **Share history**: Create initial PartTransaction for each migrated Cooperateur\n4. **Source tagging**: Migrated records get source = ONLINE_REGISTRATION (V1 data)\n5. **Status mapping**: \n   - PAYMENT_PENDING → paymentStatus=PENDING, memberStatus=PROSPECT\n   - PAID → paymentStatus=PAID, memberStatus=PROSPECT\n   - PROCESSED → paymentStatus=PAID, memberStatus=ACTIVE\n\n---\n\n### Acceptance Criteria\n\n- [ ] CooperateurV2 entity with all new fields\n- [ ] CooperateurRelationship entity for pair links\n- [ ] PartTransaction entity for share tracking\n- [ ] StatusHistory entity for status changes\n- [ ] AuditLog entity for general auditing\n- [ ] All enums defined (DataSource, MemberStatus, PaymentStatus, RelationshipType, PartTransactionType)\n- [ ] Flyway migration script (V2.0.0)\n- [ ] Repository/DAO layer updated\n- [ ] Unit tests for share computation from transactions","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-26T17:11:02.065398+01:00","updated_at":"2025-12-26T17:27:28.5296+01:00","dependencies":[{"issue_id":"sqq-inscription-5pt","depends_on_id":"sqq-inscription-46z","type":"blocks","created_at":"2025-12-26T17:31:25.359299+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-5ue","title":"Statistics dashboard","description":"## Statistics Dashboard\n\nDisplay charts and metrics for cooperateurs and parts sociales on the admin dashboard.\n\n### Backend Requirements\n\n**New API Endpoint:** `GET /api/v1/administration/statistics`\n\nReturns aggregated statistics:\n```json\n{\n  \"cooperateurs\": {\n    \"total\": 150,\n    \"byStatus\": { \"PAYMENT_PENDING\": 10, \"PAID\": 50, \"PROCESSED\": 90 },\n    \"byMonth\": [{ \"month\": \"2024-01\", \"count\": 25 }, ...],\n    \"totalParts\": 1850,\n    \"totalPartsDeSoutien\": 320,\n    \"totalRevenue\": 18500,\n    \"averagePartsPerCooperateur\": 12.3,\n    \"withBinome\": 45,\n    \"tarifReduit\": 30\n  },\n  \"partsSupplementaires\": {\n    \"total\": 75,\n    \"byStatus\": { \"PAYMENT_PENDING\": 5, \"PAID\": 20, \"PROCESSED\": 50 },\n    \"byMonth\": [{ \"month\": \"2024-01\", \"count\": 12 }, ...],\n    \"totalParts\": 450,\n    \"totalRevenue\": 4500\n  }\n}\n```\n\n**Implementation:**\n- Create `StatisticsDTO.java` for response structure\n- Add `getStatistics()` method in `AdminResource.java`\n- Use Panache queries with aggregation\n\n### Frontend Requirements\n\n**New Component:** `AdminStatistics.vue`\n\n**Charts to implement:**\n1. **Overview Cards** - Total cooperateurs, total parts, total revenue, pending actions\n2. **Registration Trend** - Line chart showing registrations by month\n3. **Status Distribution** - Pie/donut chart for PENDING/PAID/PROCESSED\n4. **Parts Distribution** - Bar chart comparing parts sociales vs parts de soutien\n5. **Tarif Réduit** - Percentage of reduced rate members\n\n**Chart Library Options:**\n- Chart.js with vue-chartjs wrapper (lightweight)\n- Or Apache ECharts (more features)\n\n**Integration:**\n- Add as first tab in AdminCooperateurs.vue or separate route `/admin/stats`\n- Add navigation between stats and management views\n\n### Files to Create/Modify\n\n**Backend:**\n- `src/main/java/org/sqq/registration/StatisticsDTO.java` (new)\n- `src/main/java/org/sqq/registration/AdminResource.java` (modify)\n\n**Frontend:**\n- `src/main/webui/src/components/AdminStatistics.vue` (new)\n- `src/main/webui/package.json` (add chart library)\n- `src/main/webui/src/router/index.ts` (optional new route)\n- Orval will auto-generate API client after OpenAPI spec updates","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-12-26T14:52:08.900363+01:00","updated_at":"2025-12-26T16:39:40.004066+01:00","deleted_at":"2025-12-26T16:39:40.004066+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"sqq-inscription-6c0","title":"Administration UI V2","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2025-12-26T14:50:52.890367+01:00","updated_at":"2025-12-26T16:39:44.473261+01:00","dependencies":[{"issue_id":"sqq-inscription-6c0","depends_on_id":"sqq-inscription-5ue","type":"blocks","created_at":"2025-12-26T14:52:17.278963+01:00","created_by":"daemon"},{"issue_id":"sqq-inscription-6c0","depends_on_id":"sqq-inscription-00e","type":"blocks","created_at":"2025-12-26T14:53:21.390632+01:00","created_by":"daemon"}],"deleted_at":"2025-12-26T16:39:44.473261+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"epic"}
{"id":"sqq-inscription-6pj","title":"Create PartTransaction entity","description":"## Create PartTransaction Entity\n\nTracks all share purchases and changes over time for historical auditing.\n\n### Fields\n\n| Field | Type | Notes |\n|-------|------|-------|\n| id | Long | Primary key |\n| cooperateur_id | Long | FK to CooperateurV2 |\n| transactionType | PartTransactionType | INITIAL_PURCHASE, ADDITIONAL_PURCHASE, ADJUSTMENT, REFUND |\n| parts | Long | Number of shares (can be negative for refunds) |\n| reason | String | Optional explanation |\n| stripeSessionId | String | If payment was involved |\n| createdAt | Timestamp | |\n\n### Share Computation\nCurrent shares are computed as: `SELECT SUM(parts) FROM PartTransaction WHERE cooperateur_id = ?`\n\n### Purpose\n- Replace direct parts field on Cooperateur\n- Enable full share transaction history\n- Support refunds and adjustments with audit trail\n\n### Acceptance Criteria\n- [ ] Entity class created with FK to CooperateurV2\n- [ ] Support for positive and negative values\n- [ ] Method or query to compute total shares for a cooperateur","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T17:29:50.264152+01:00","updated_at":"2025-12-26T17:30:41.733267+01:00","dependencies":[{"issue_id":"sqq-inscription-6pj","depends_on_id":"sqq-inscription-9wi","type":"blocks","created_at":"2025-12-26T17:31:22.36795+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-6rb","title":"V1 to V2 Data Migration Engine","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-26T17:11:03.742786+01:00","updated_at":"2025-12-26T17:11:03.742786+01:00","dependencies":[{"issue_id":"sqq-inscription-6rb","depends_on_id":"sqq-inscription-5pt","type":"blocks","created_at":"2025-12-26T17:14:29.415336+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-8fz","title":"Administration Grid V2 - Unified Member Management","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-26T17:11:05.455874+01:00","updated_at":"2025-12-26T17:11:05.455874+01:00","dependencies":[{"issue_id":"sqq-inscription-8fz","depends_on_id":"sqq-inscription-5pt","type":"blocks","created_at":"2025-12-26T17:14:29.699104+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-8j7","title":"Legacy CSV Import to V2 Model","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-26T17:11:06.814213+01:00","updated_at":"2025-12-26T17:11:06.814213+01:00","dependencies":[{"issue_id":"sqq-inscription-8j7","depends_on_id":"sqq-inscription-5pt","type":"blocks","created_at":"2025-12-26T17:14:29.791886+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-9wi","title":"Create CooperateurV2 entity","description":"## Create CooperateurV2 Entity\n\nImplement the main CooperateurV2 entity with restructured fields.\n\n### Fields\n\n| Field | Type | Notes |\n|-------|------|-------|\n| id | Long | Primary key (auto-generated) |\n| genre | Genre | MADAME, MONSIEUR |\n| prenom | String | First name (required) |\n| nom | String | Last name (required) |\n| dateNaissance | String | Birth date (NEW) |\n| telephone | String | Required |\n| email | String | Required |\n| adresse | String | Required |\n| ville | String | Required |\n| codePostal | String | Required |\n| etudiantOuMinimasSociaux | Boolean | Student or low-income status |\n| nombreDePersonnesDansLeFoyer | Long | Household size (min 1) |\n| acceptationDesStatus | Boolean | Terms acceptance |\n| paymentStatus | PaymentStatus | Renamed from status - PENDING, PAID |\n| memberStatus | MemberStatus | NEW - PROSPECT, ACTIVE, SUSPENDED, DEPARTED |\n| source | DataSource | NEW - ONLINE_REGISTRATION, CSV_IMPORT, MANUAL_ENTRY |\n| notes | String | NEW - Admin notes (optional) |\n| stripeSessionId | String | Stripe checkout session ID |\n| createdAt | Timestamp | |\n| updatedAt | Timestamp | |\n\n### Removed Fields (from V1)\n- `parts` - Now computed from PartTransaction sum\n- `partsDeSoutien` - Tracked via PartTransaction\n- `binome_id` - Replaced by CooperateurRelationship table\n\n### Acceptance Criteria\n- [ ] Entity class created with all fields\n- [ ] JPA/Panache annotations configured\n- [ ] Validation annotations applied","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T17:29:49.46884+01:00","updated_at":"2025-12-26T17:30:41.024512+01:00","dependencies":[{"issue_id":"sqq-inscription-9wi","depends_on_id":"sqq-inscription-on1","type":"blocks","created_at":"2025-12-26T17:31:21.70735+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-ck0","title":"Manual Onboarding V2 - Solo and Pair Registration","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-26T17:11:08.462385+01:00","updated_at":"2025-12-26T17:11:08.462385+01:00","dependencies":[{"issue_id":"sqq-inscription-ck0","depends_on_id":"sqq-inscription-5pt","type":"blocks","created_at":"2025-12-26T17:14:29.881121+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-dc4","title":"Update Repository/DAO layer for V2 entities","description":"## Update Repository/DAO Layer for V2 Entities\n\nCreate Panache repositories for all V2 entities.\n\n### Repositories to Create\n\n1. **CooperateurV2Repository**\n   - CRUD operations\n   - Find by email, phone\n   - Search/filter methods\n\n2. **CooperateurRelationshipRepository**\n   - Find relationship for a cooperateur\n   - Find partner by cooperateur\n\n3. **PartTransactionRepository**\n   - Find transactions by cooperateur\n   - Compute total shares (sum of parts)\n   - Find transactions by type\n\n4. **StatusHistoryRepository**\n   - Find history by cooperateur\n   - Find latest status change\n\n5. **AuditLogRepository**\n   - Find logs by entity\n   - Find logs by user\n   - Date range queries\n\n### Acceptance Criteria\n- [ ] All 5 repositories created\n- [ ] Custom query methods implemented\n- [ ] Share computation query tested","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T17:29:51.986272+01:00","updated_at":"2025-12-26T17:31:04.295229+01:00","dependencies":[{"issue_id":"sqq-inscription-dc4","depends_on_id":"sqq-inscription-t9f","type":"blocks","created_at":"2025-12-26T17:31:24.716654+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-o02","title":"Create CooperateurRelationship entity","description":"## Create CooperateurRelationship Entity\n\nLinks Cooperateurs who registered together as a pair (binome).\n\n### Fields\n\n| Field | Type | Notes |\n|-------|------|-------|\n| id | Long | Primary key |\n| cooperateur1_id | Long | FK to CooperateurV2 |\n| cooperateur2_id | Long | FK to CooperateurV2 |\n| relationshipType | RelationshipType | PAIR (extensible for future types) |\n| createdAt | Timestamp | |\n\n### Purpose\n- Replace the old binome_id foreign key approach\n- Both people in a pair become full Cooperateurs\n- Relationship is tracked separately for better querying and flexibility\n\n### Acceptance Criteria\n- [ ] Entity class created with FK relationships\n- [ ] Bidirectional relationship mappings\n- [ ] Unique constraint on cooperateur pair","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T17:29:49.834114+01:00","updated_at":"2025-12-26T17:30:41.255016+01:00","dependencies":[{"issue_id":"sqq-inscription-o02","depends_on_id":"sqq-inscription-9wi","type":"blocks","created_at":"2025-12-26T17:31:22.144727+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-on1","title":"Create V2 model enums","description":"## Create V2 Model Enums\n\nDefine all enumerations required for the V2 data model:\n\n### Enums to Create\n\n1. **DataSource** - Track origin of member records\n   - `ONLINE_REGISTRATION` - Registered via web form\n   - `CSV_IMPORT` - Imported from legacy CSV\n   - `MANUAL_ENTRY` - Manually entered by admin\n\n2. **MemberStatus** - Lifecycle states for cooperative members\n   - `PROSPECT` - Registered but not yet active\n   - `ACTIVE` - Active cooperative member\n   - `SUSPENDED` - Temporarily suspended\n   - `DEPARTED` - Left the cooperative\n\n3. **PaymentStatus** - Payment state tracking\n   - `PENDING` - Payment not yet completed\n   - `PAID` - Payment received\n\n4. **RelationshipType** - Types of cooperateur relationships\n   - `PAIR` - Binome/paired registration\n\n5. **PartTransactionType** - Types of share transactions\n   - `INITIAL_PURCHASE` - First share purchase at registration\n   - `ADDITIONAL_PURCHASE` - Subsequent share purchases\n   - `ADJUSTMENT` - Manual correction by admin\n   - `REFUND` - Shares returned\n\n### Acceptance Criteria\n- [ ] All 5 enums defined in model package\n- [ ] Enums follow existing project conventions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T17:29:48.794595+01:00","updated_at":"2025-12-26T17:34:43.52531+01:00","closed_at":"2025-12-26T17:34:43.52531+01:00","close_reason":"Closed"}
{"id":"sqq-inscription-t9f","title":"Create V2 Flyway migration script","description":"## Create V2 Flyway Migration Script\n\nCreate Flyway migration V2.0.0 for all V2 data model changes.\n\n### Tables to Create\n\n1. **cooperateur_v2** - Main member table with new structure\n2. **cooperateur_relationship** - Pair/binome links\n3. **part_transaction** - Share transaction history\n4. **status_history** - Status change audit trail\n5. **audit_log** - General entity audit log\n\n### Migration Considerations\n- This creates the V2 schema alongside V1 (non-destructive)\n- Data migration from V1 to V2 is handled separately (sqq-inscription-6rb)\n- Include appropriate indexes for query performance\n- Add foreign key constraints with proper cascade rules\n\n### Acceptance Criteria\n- [ ] Migration script V2__create_v2_schema.sql created\n- [ ] All 5 tables defined with correct types\n- [ ] Foreign keys and indexes configured\n- [ ] Migration runs successfully on clean database","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T17:29:51.649301+01:00","updated_at":"2025-12-26T17:31:04.067624+01:00","dependencies":[{"issue_id":"sqq-inscription-t9f","depends_on_id":"sqq-inscription-9wi","type":"blocks","created_at":"2025-12-26T17:31:23.060012+01:00","created_by":"daemon"},{"issue_id":"sqq-inscription-t9f","depends_on_id":"sqq-inscription-o02","type":"blocks","created_at":"2025-12-26T17:31:23.433576+01:00","created_by":"daemon"},{"issue_id":"sqq-inscription-t9f","depends_on_id":"sqq-inscription-6pj","type":"blocks","created_at":"2025-12-26T17:31:23.667806+01:00","created_by":"daemon"},{"issue_id":"sqq-inscription-t9f","depends_on_id":"sqq-inscription-2jp","type":"blocks","created_at":"2025-12-26T17:31:24.079068+01:00","created_by":"daemon"},{"issue_id":"sqq-inscription-t9f","depends_on_id":"sqq-inscription-0sc","type":"blocks","created_at":"2025-12-26T17:31:24.315547+01:00","created_by":"daemon"}]}
{"id":"sqq-inscription-uos","title":"Administration Portal V2 - Architecture \u0026 Data Migration","description":"## 1. Executive Summary\n**Goal:** Transition from a basic registration system to a scalable Member Management Platform.\n**Core Strategy:** Implement a new clean-slate data model (`CooperateurV2`) where every individual—including partners in a pair (\"Binômes\")—is treated as a distinct entity.\n**Why:** The current model treats a \"Binôme\" as a sub-property of a main member. This creates reporting friction and limits future features (e.g., individual login).\n**Language:** The entire UI must be in **French**.\n\n## 2. Design \u0026 UX Guidelines\n*   **Visual Identity:** Professionalize the existing palette. Focus on \"Admin Density\" (more data per screen) rather than \"Marketing Airiness.\"\n*   **Architecture \u0026 Routing:**\n    *   **Strict Separation:** `Cooperateur` (V1) is for legacy support only. `CooperateurV2` is the future.\n    *   **API:** All new logic resides under `/api/v2/`.\n    *   **Frontend:** New views reside under `/v2/`.\n*   **UX Philosophy:** \"Single Source of Truth.\" Whether a member joined via V1, is a Binôme of someone else, or is imported from Sheets, they appear as a standard row in the grid.\n\n## 3. User Stories \u0026 Features\n\n### Feature A: The New Data Model (CooperateurV2)\nAs a Developer, I need to implement a robust entity structure that supports the new \"Binôme as a Member\" philosophy.\n\n*   **The V2 Entity:** `CooperateurV2`\n    *   Standardizes fields (Name, Email, etc.).\n    *   **Binôme Linkage:** Instead of embedding a `Binome` object, we link two `CooperateurV2` entities together.\n*   **Payment Method - \"BINOME\":**\n    *   We need a specific status or payment type called `BINOME`.\n    *   *Logic:* If Alice pays for the pair, Alice has `Payment: STRIPE/CHECK`. Bob (her binôme) is a separate `CooperateurV2` entry, but his payment status/method is flagged as `BINOME` (implying \"Covered by partner\").\n\n### Feature B: The Migration Engine\nAs an Administrator, I need to convert existing V1 data into the V2 format so that everyone is in the new system.\n\n*   **One-Click Migration Endpoint:** An API action (e.g., `POST /api/v2/migration/from-v1`) that triggers the conversion.\n*   **Transformation Logic:**\n    *   **1 V1 Record $\\to$ 2 V2 Records:** If a V1 `Cooperateur` has a `binome`, the system must create **TWO** `CooperateurV2` entities.\n        *   *Primary:* Copies the main data. Payment = Original Payment.\n        *   *Secondary (Binôme):* Created from the embedded `Binome` data. Payment = \"BINOME\".\n    *   **Linkage:** The two new entities must be associated in the database.\n*   **Idempotency:** Running the migration twice should not duplicate users (check via email).\n\n### Feature C: Advanced Administration Grid (V2)\nAs an Administrator, I need to manage all members in a unified list.\n\n*   **Unified List:** The table displays Primary Members and Binômes side-by-side as individual rows.\n*   **Advanced Columns:**\n    *   \"Type\": Main vs. Binôme.\n    *   \"Lié à\" (Linked to): If the user is a Binôme, show the name of the Primary member.\n*   **Filtering:**\n    *   Filter by Payment Method (e.g., \"Show me everyone whose payment is 'BINOME'\").\n*   **Columns \u0026 Actions:** Pagination, Search, Column Picker, and \"View Details\" remain standard requirements.\n\n### Feature D: Legacy Data Import (CSV)\nAs an Administrator, I need to import the historical Google Sheet into the **V2 model**.\n\n*   **Archival:** Raw CSV is saved to a staging table first.\n*   **ETL Process:**\n    *   Rows representing a pair in the CSV must generate **two** `CooperateurV2` records.\n    *   Logic for \"Parts\" (Shares):\n        *   *Primary:* Holds the financial data (Number of parts, Investment amount).\n        *   *Binôme:* 0 financial parts, but flagged as active member via the link.\n\n### Feature E: Manual Onboarding (V2)\nAs an Administrator, I need to add new members directly into the V2 system.\n\n*   **Add \"Solo\" Member:** Standard form. Select Payment (Check, Transfer).\n*   **Add \"Pair\" (Binôme):**\n    *   Form captures data for Person A and Person B.\n    *   Backend creates two `CooperateurV2` entities.\n    *   Person A holds the financial details.\n    *   Person B is linked to A.\n\n## 4. Technical Notes for Developers\n\n### Database Schema Strategy\n*   **Do not modify the `Cooperateur` table.** It is frozen for V1 public registration compatibility.\n*   **New Table: `CooperateurV2`**\n    *   Likely needs a Self-Reference relationship (`partner_id` points to another `CooperateurV2`) or a Join Table if we ever support groups \u003e 2 (though requirements say Binôme = Pair).\n    *   New Enum/Field: `PaymentCategory` containing `STRIPE`, `CHEQUE`, `VIREMENT`, and **`BINOME`**.\n\n### Migration Pseudo-Logic\n```java\n// Conceptual Logic for the Migration Endpoint\nList\u003cCooperateur\u003e v1List = cooperateurRepo.listAll();\n\nfor (Cooperateur v1 : v1List) {\n    // 1. Create Main V2 Entity\n    CooperateurV2 main = mapToV2(v1);\n    main.paymentType = v1.stripeSessionId != null ? STRIPE : OTHER;\n    \n    if (v1.binome != null) {\n        // 2. Create Partner V2 Entity\n        CooperateurV2 partner = mapBinomeToV2(v1.binome);\n        partner.paymentType = BINOME; // Crucial for filtering\n        \n        // 3. Link them\n        main.setPartner(partner);\n        partner.setPartner(main);\n        \n        persist(partner);\n    }\n    persist(main);\n}\n```\n\n\n## 5. Definition of Done\n*   [ ] `CooperateurV2` entity is created and functional.\n*   [ ] Migration endpoint (`/api/v2/migration`) successfully converts 100% of V1 data.\n*   [ ] V1 data with Binomes results in **two** searchable records in the V2 Admin Table.\n*   [ ] Admin can filter to see only \"Main\" payers or only \"Binômes\".\n*   [ ] CSV Import populates the `CooperateurV2` table correctly.\n\n***\n\n### Key Changes from Previous Version:\n1.  **Explicit V2 Entity:** We are no longer trying to shoehorn the new logic into the old class.\n2.  **Binôme = Cooperateur:** The requirement that a Binôme is a full-fledged member is now the central architectural driver.\n3.  **Payment Logic:** Introduced the specific requirement that the Binôme's payment method is effectively \"Paid by Partner\" (labeled `BINOME` in the tech notes).","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-26T17:07:28.987458+01:00","updated_at":"2025-12-26T17:07:28.987458+01:00","dependencies":[{"issue_id":"sqq-inscription-uos","depends_on_id":"sqq-inscription-5pt","type":"blocks","created_at":"2025-12-26T17:14:20.533917+01:00","created_by":"daemon"},{"issue_id":"sqq-inscription-uos","depends_on_id":"sqq-inscription-6rb","type":"blocks","created_at":"2025-12-26T17:14:20.852838+01:00","created_by":"daemon"},{"issue_id":"sqq-inscription-uos","depends_on_id":"sqq-inscription-8fz","type":"blocks","created_at":"2025-12-26T17:14:20.973039+01:00","created_by":"daemon"},{"issue_id":"sqq-inscription-uos","depends_on_id":"sqq-inscription-8j7","type":"blocks","created_at":"2025-12-26T17:14:21.058631+01:00","created_by":"daemon"},{"issue_id":"sqq-inscription-uos","depends_on_id":"sqq-inscription-ck0","type":"blocks","created_at":"2025-12-26T17:14:21.144929+01:00","created_by":"daemon"}]}
